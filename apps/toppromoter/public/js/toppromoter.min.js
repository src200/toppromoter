let ToppromoterDomainRoot="https://toppromoter.vercel.app";const ToppromoterAPIRoot=(ToppromoterDomainRoot=window.location.href.includes("toppromoterTestingMode=true")?"http://localhost:9000":ToppromoterDomainRoot)+"/api/v1",rootDomain=window.location.origin,queryString=window.location.search,urlParams=new URLSearchParams(queryString),toppromoterVerifyParam=urlParams.get("toppromoterVerify"),toppromoterReferralParam=urlParams.get("via")?urlParams.get("via"):urlParams.get("ref")?urlParams.get("ref"):null,toppromoterRetrieveReferralParam=urlParams.get("referral")?urlParams.get("referral"):null;let toppromoterReferralObject=localStorage.getItem("toppromoterReferral");const toppromoterInnerScript=document.querySelector("script[data-toppromoter]");let scrolledPercentage=((document.documentElement.scrollTop+document.body.scrollTop)/(document.documentElement.scrollHeight-document.documentElement.clientHeight)*100).toFixed(0);class tpr{details(){return{companyId:toppromoterInnerScript.getAttribute("data-toppromoter")?toppromoterInnerScript.getAttribute("data-toppromoter"):null,rootDomain:rootDomain,domains:toppromoterInnerScript.getAttribute("data-domains")?toppromoterInnerScript.getAttribute("data-domains"):null,hidePopup:!!toppromoterInnerScript.getAttribute("hidePopup"),privacyCompliance:!!toppromoterInnerScript.getAttribute("privacyCompliance"),apiUrl:ToppromoterAPIRoot}}async checkDomainVerification(){return fetch(ToppromoterAPIRoot+"/verify-company").then(function(o){return o.json()})}async impression(o,e){return o&&e||console.warn("Toppromoter.io: could not track impression. Referral code / companyId not found."),fetch(ToppromoterAPIRoot+"/record-referral",{method:"POST",body:JSON.stringify({referralCode:o,companyId:e})}).then(function(o){return o.json()})}async campaignDetails(o,e){return o&&e||console.warn("Toppromoter.io: could not get campaign details. Referral code / companyId not found."),fetch(ToppromoterAPIRoot+"/campaign-details",{method:"POST",body:JSON.stringify({referralCode:o,companyId:e})}).then(function(o){return o.json()})}checkCookie(){var e="toppromoterData=",t=decodeURIComponent(document.cookie).split(";");for(let r=0;r<t.length;r++){let o=t[r];for(;" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))try{return JSON.parse(o.substring(e.length,o.length))}catch(o){return{error:!0}}}return null}deleteCookie(){return document.cookie="toppromoterData=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;","cookie_deleted"}consentRequired(){return!!(Intl.DateTimeFormat().resolvedOptions().timeZone&&0<=Intl.DateTimeFormat().resolvedOptions().timeZone.indexOf("Europe")&&!0===Toppromoter.details().privacyCompliance)}cookieEligible(){return null!==toppromoterReferralParam&&null!==Toppromoter.details().companyId&&null===Toppromoter.checkCookie()}cookieExists(){return null!==Toppromoter.checkCookie()}checkForOtherDomains(){return!(!Toppromoter.details().domains||null===Toppromoter.checkCookie()||(Toppromoter.details().domains?.includes(",")&&document.querySelectorAll("[href]").forEach(t=>{let r=new URL(t.href);r.origin!==Toppromoter.details().rootDomain&&Toppromoter.details().domains.replace(/”/g,"").split(",").map(o=>{var e;r.origin===o.trim()&&((e=r.searchParams).set("referral",Toppromoter.checkCookie()?.referral_id),r.search=e.toString(),e=r.toString(),t.href=e)})}),0))}consentCleanup(){document.getElementById("toppromoter-confirm-modal")&&document.getElementById("toppromoter-confirm-modal").parentNode.removeChild(document.getElementById("toppromoter-confirm-modal")),document.getElementById("toppromoter-confirm")&&document.getElementById("toppromoter-confirm").parentNode.removeChild(document.getElementById("toppromoter-confirm")),document.getElementById("toppromoter-confirm-styles")&&document.getElementById("toppromoter-confirm-styles").parentNode.removeChild(document.getElementById("toppromoter-confirm-styles")),document.getElementById("toppromoter-consent")&&document.getElementById("toppromoter-consent").parentNode.removeChild(document.getElementById("toppromoter-consent"))}async register(){var o;!0===Toppromoter.cookieEligible()&&(document.getElementById("toppromoter-confirm-button")&&(document.getElementById("toppromoter-confirm-button").innerText="Loading..."),(o=await Toppromoter.impression(toppromoterReferralParam,Toppromoter.details().companyId))?.referral_details?(document.cookie=`toppromoterData=${JSON.stringify(o?.referral_details)}; expires=`+o?.referral_details?.cookie_date,Toppromoter.checkForOtherDomains()):Toppromoter.consentCleanup())}async showPopup(){if(localStorage.getItem("toppromoterNoConsent"))return!1;const e=await Toppromoter.campaignDetails(toppromoterReferralParam,Toppromoter.details().companyId);if(!e?.campaign_details)return!1;var o=`
      <div id="toppromoter-confirm-modal">
        <div id="toppromoter-confirm">
          <div id="toppromoter-content-top">
          ${null!==e?.campaign_details?.discount_value&&"fixed"===e?.campaign_details?.discount_type&&e?.campaign_details?.company_currency?"<p id='toppromoter-content-title'>You've earned <span>"+e?.campaign_details?.company_currency+e?.campaign_details?.discount_value+" off</span> from a referral.</p>":null!==e?.campaign_details?.discount_value?"<p id='toppromoter-content-title'>You've earned <span>"+e?.campaign_details?.discount_value+"% off</span> from a referral.</p>":"<p id='toppromoter-content-title'>The person who sent you here can earn a referral."}
            <p id="toppromoter-content-subtitle">To receive the discount code, please confirm that you consent to using cookies.</p>
          </div>
          <div id="toppromoter-buttons">
            <div id="toppromoter-confirm-button">Accept cookie & get discount</div>
            <div id="toppromoter-cancel-button">No thanks</div>
          </div>
          <div id="toppromoter-content-bottom">
            <p>Please confirm that you're ok for a cookie to be set for our <span>privacy-friendly referral system</span>. The person who sent you here will earn a referral reward, and you'll be given a discount code to use on this site.</p>
          </div>
        </div>
      </div>
    `;document.getElementById("toppromoter-confirm")||(document.body.innerHTML+=o),setTimeout(()=>{document.getElementById("toppromoter-confirm-modal").classList.add("toppromoter-appear")},500),document.getElementById("toppromoter-confirm-styles")||((o=document.createElement("style")).type="text/css",o.innerText=`
        #toppromoter-confirm-modal {
          position: fixed;
          z-index: 2147483646;
          width: 100%;
          height: 100%;
          top: 0;
          left: 0;
          transition: all 0.4s ease-in-out;
          transition-delay: 1s;
        }
        #toppromoter-confirm-modal.toppromoter-appear {
          background-color: rgba(0,0,0,0.5);
        }
        #toppromoter-confirm {
          position: fixed;
          bottom: 0%;
          left: 50%;
          margin-bottom: 30px;
          transform: translate(-50%, 15%);
          text-align: center;
          font-family: ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";
          border-radius: 15px;
          overflow: hidden;
          z-index: 2147483647;
          background-color: #FFFFFF;
          border: 4px solid #c2c2c2;
          padding: 18px;
          width: 92%;
          max-width: 320px;
          box-shadow: 0 0 250px rgba(255,255,255,0.60);
          color: #000000;
          opacity: 0;
          transition: all 0.8s ease-in-out;
          transition-delay: 1.5s;
        }
        #toppromoter-confirm-modal.toppromoter-appear #toppromoter-confirm{
          opacity: 1;
          transform: translate(-50%, 0%);
        }
        #toppromoter-confirm * {
          box-sizing: border-box;
        }
        #toppromoter-content-top {
          width: 100%;
        }
        #toppromoter-content-title {
          font-size: 16px;
          line-height: 20px;
          font-weight: bold;
          margin-bottom: 8px;
        }
        #toppromoter-content-title span {
          text-decoration: underline; 
        }
        #toppromoter-content-subtitle {
          font-size: 15px;
          line-height: 20px;
        }
        #toppromoter-confirm-button {
          padding: 15px;
          border-radius: 15px;
          font-size: 16px;
          font-weight: bold;
          background: #ddd;
          cursor: pointer;
          margin-top: 15px;
          border: 2px solid #cccccc;
          color: #000;
        }
        #toppromoter-confirm-button:hover {
          background-color: #cccccc;
        }
        #toppromoter-cancel-button {
          margin-top: 10px;
          font-size: 12px;
          cursor: pointer;
          text-decoration: underline;
        }
        #toppromoter-content-bottom {
          width: 100%;
          margin-top: 15px;
          padding-bottom: 10px;
          border-top: 4px solid #e3e3e3;
        }
        #toppromoter-content-bottom p {
          margin-top: 15px;
          font-size: 13px;
          line-height: 18px;
          color: #848484;
        }
        #toppromoter-content-bottom span {
          font-weight: bold;
        }
        #toppromoter-buttons {
          width: 100%;
        }
        #toppromoter-discount-code {
          width: 100%;
        }
        #toppromoter-discount-code-input {
          font-size: 18px;
          font-weight: bold;
          padding: 10px 20px;
          background: #efefef;
          border: 4px solid #cccccc;
          width: 100%;
          display: block;
          margin-top: 10px;
          cursor: pointer;
          appearance: none;
          -webkit-appearance: none;
          text-align: center;
          color: #000;
        }
        #toppromoter-discount-code-text {
          margin-top: 10px;
        }
        #toppromoter-discount-code-text p {
          font-size: 14px;
          line-height: 19px;
          font-style: italic;
          font-weight: bold;
          color: #848484;
        }
        #toppromoter-close-button {
          margin-top: 10px;
          font-size: 16px;
          color: #000;
          font-weight: bold;
          cursor: pointer;
          text-decoration: underline;
        }
      `,o.setAttribute("id","toppromoter-confirm-styles"),document.head.appendChild(o)),document.getElementById("toppromoter-confirm-button")&&document.getElementById("toppromoter-confirm-button").addEventListener("click",function(){var o;document.getElementById("toppromoter-buttons")&&(o=`
            <div id="toppromoter-discount-code">
              <input value="${e?.campaign_details?.discount_code}" id="toppromoter-discount-code-input" type="text" name="toppromoter-discount-code-input"/>
            </div>
            <div>
              <div id="toppromoter-close-button">Close popup</div>
            </div>
          `,document.getElementById("toppromoter-buttons").innerHTML=o,document.getElementById("toppromoter-content-subtitle")&&(document.getElementById("toppromoter-content-subtitle").innerText="Use the below discunt code at checkout:"),document.getElementById("toppromoter-discount-code-input")&&e?.campaign_details?.discount_code&&document.getElementById("toppromoter-discount-code-input").addEventListener("click",function(){document.getElementById("toppromoter-discount-code-input").select(),document.execCommand("copy"),document.getElementById("toppromoter-discount-code").innerHTML+=`
                <div id="toppromoter-discount-code-text">
                  <p>Copied to clipboard</p>
                </div>
              `}),document.getElementById("toppromoter-close-button"))&&document.getElementById("toppromoter-close-button").addEventListener("click",function(){Toppromoter.consentCleanup()}),Toppromoter.register()}),document.getElementById("toppromoter-cancel-button")&&document.getElementById("toppromoter-cancel-button").addEventListener("click",function(){Toppromoter.consentCleanup(),localStorage.setItem("toppromoterNoConsent",!0)})}async signup(o){var e;return console.log("Toppromoter.io: Running signup function"),o&&null!==Toppromoter.checkCookie()?("error"!==(e=await fetch(ToppromoterAPIRoot+"/signup-referral",{method:"POST",body:JSON.stringify({referralId:Toppromoter.checkCookie().referral_id,cookieDate:Toppromoter.checkCookie().cookie_date,email:o})}).then(function(o){return o.json()}))?.signup_details&&console.log("Toppromoter.io: Signup function successful"),e):(console.warn("Toppromoter.io: Signup could not be tracked."),!1)}getReferralId(){return null!==Toppromoter.checkCookie()&&Toppromoter.checkCookie().referral_id?Toppromoter.checkCookie().referral_id:null}async retrieve(o,e){var t=await fetch(ToppromoterAPIRoot+"/retrieve-referral",{method:"POST",body:JSON.stringify({referralId:o,companyId:e})}).then(function(o){return o.json()});return null!==t&&(console.log("Toppromoter cookie was set"),document.cookie=`toppromoterData=${JSON.stringify(t?.referral_details)}; expires=`+t?.referral_details?.cookie_date,!0)}}var Toppromoter=new tpr;function activatePopup(){33<=scrolledPercentage&&!1===Toppromoter.details().hidePopup&&!0===Toppromoter.consentRequired()&&!1===Toppromoter.cookieExists()&&setTimeout(()=>{Toppromoter.showPopup()},2e3)}null!==toppromoterVerifyParam&&"true"===toppromoterVerifyParam&&Toppromoter.checkDomainVerification().then(o=>{!0===o?.verified&&(console.log("Domain verified:"),console.log("Redirect string: ",`${ToppromoterDomainRoot}/dashboard/${Toppromoter.details().companyId}/setup/verify`),window.location.href=`${ToppromoterDomainRoot}/dashboard/${Toppromoter.details().companyId}/setup/verify`)}),!1===Toppromoter.consentRequired()&&!0===Toppromoter.cookieEligible()&&Toppromoter.register(),document.addEventListener("DOMContentLoaded",function(){Toppromoter.checkForOtherDomains()}),activatePopup(),window.addEventListener("scroll",function o(){33<=(scrolledPercentage=((document.documentElement.scrollTop+document.body.scrollTop)/(document.documentElement.scrollHeight-document.documentElement.clientHeight)*100).toFixed(0))&&(window.removeEventListener("scroll",o,!1),activatePopup())},!1),null!==toppromoterRetrieveReferralParam&&!1===Toppromoter.cookieExists()&&(console.log("Running referral retrieve function"),Toppromoter.retrieve(toppromoterRetrieveReferralParam,Toppromoter.details().companyId)),!0===Toppromoter.cookieExists()&&Toppromoter.consentCleanup(),window.addEventListener("load",function(){document.querySelector("form[data-toppromoter]")&&null!==Toppromoter.checkCookie()&&document.querySelectorAll("form[data-toppromoter]").forEach(o=>{var e=document.createElement("input");e.type="hidden",e.name="toppromoter_referral_id",e.id="toppromoter_referral_id",e.value=Toppromoter.checkCookie().referral_id,o.appendChild(e)})}),toppromoterInnerScript||console.error("Could not load Toppromoter: make sure the <script> tag includes data-toppromoter='<companyId>'");